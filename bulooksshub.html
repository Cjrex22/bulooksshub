
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BU.Style - Fashion Rating Community</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="4.1">
    <meta name="build" content="2025-01-27-v4-MOBILE-FIXED">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, private">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a0f1a 0%, #2d1b2e 25%, #3d1a3d 50%, #4a1a4a 75%, #5a1a5a 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Special voting page background */
        #votingPage {
            background: linear-gradient(135deg, #1a0f1a 0%, #2d1b2e 20%, #3d1a3d 40%, #4a1a4a 60%, #5a1a5a 80%, #6a1a6a 100%);
            background-size: 600% 600%;
            animation: votingGradientShift 10s ease infinite;
            min-height: 100vh;
            position: relative; /* allow cloud layer positioning */
        }

        @keyframes votingGradientShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 50% 100%; }
            75% { background-position: 0% 0%; }
            100% { background-position: 0% 50%; }
        }

        /* Subtle clouds for voting page */
        .cloud-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.18), rgba(255,255,255,0.08) 60%, rgba(255,255,255,0) 70%);
            filter: blur(8px);
            opacity: 0.18;
            border-radius: 50%;
            animation: cloudDrift linear infinite;
        }

        @keyframes cloudDrift {
            0% { transform: translateX(-15%); }
            100% { transform: translateX(115%); }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 77, 141, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 0.8; }
        }

        .header {
            background: rgba(26, 15, 26, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 2px solid #ff4d8d;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(255, 77, 141, 0.2);
        }

        .logo {
            font-family: 'Montserrat', 'Poppins', sans-serif;
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(45deg, #ff4d8d, #ff80ab, #ffc1cc, #ff4d8d);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
            animation: logoGlow 3s ease-in-out infinite, logoGradient 4s ease infinite;
            text-shadow: 0 0 30px rgba(255, 77, 141, 0.5);
            position: relative;
        }

        @keyframes logoGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 10px rgba(255, 77, 141, 0.3)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 20px rgba(255, 77, 141, 0.6)); }
        }

        @keyframes logoGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .main-content {
            margin-top: 100px;
            padding: 2rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
            z-index: 2;
        }

        /* Entrance animations */
        .fade-in {
            animation: fadeInUp 1s ease-out forwards;
            opacity: 0;
            transform: translateY(30px);
        }

        .fade-in-delay-1 {
            animation-delay: 0.2s;
        }

        .fade-in-delay-2 {
            animation-delay: 0.4s;
        }

        .fade-in-delay-3 {
            animation-delay: 0.6s;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-family: 'Montserrat', 'Poppins', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            text-align: center;
            margin: 3rem 0 2.5rem 0;
            background: linear-gradient(45deg, #ff4d8d, #ff80ab, #ffc1cc, #ff4d8d);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            animation: titleGlow 3s ease-in-out infinite, titleGradient 4s ease infinite;
            text-shadow: 0 0 30px rgba(255, 77, 141, 0.4);
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 15px rgba(255, 77, 141, 0.4)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 25px rgba(255, 77, 141, 0.7)); }
        }

        @keyframes titleGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .voting-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.75rem;
            margin: 2rem 0;
            padding: 1rem;
            justify-items: center;
        }


        .profile-card {
            width: 100%;
            max-width: 92vw;
            padding: 2rem 2rem 1rem;
            margin: 0.5rem 0;
            min-height: 0; /* Let content define height */
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid transparent;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255, 77, 141, 0.1), rgba(255, 192, 204, 0.05));
            border-radius: 20px;
            z-index: -1;
            transition: all 0.3s ease;
        }

        .profile-card:hover {
            transform: translateY(-15px) scale(1.05);
            border-color: #ff4d8d;
            box-shadow: 0 25px 50px rgba(255, 77, 141, 0.4);
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
        }

        .profile-card:hover::before {
            background: linear-gradient(45deg, rgba(255, 77, 141, 0.15), rgba(255, 192, 204, 0.08));
        }

        .profile-photo {
            width: min(480px, 92vw);
            height: min(480px, 92vw);
            margin: 0 auto 1rem auto;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #ff4d8d;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 12px 35px rgba(255, 77, 141, 0.3);
            position: relative;
        }

        .profile-card:hover .profile-photo {
            border-color: #ff80ab;
            box-shadow: 0 20px 45px rgba(255, 77, 141, 0.5);
            transform: scale(1.08) rotate(2deg);
        }

        .profile-name {
            font-family: 'Montserrat', 'Poppins', sans-serif;
            font-size: 1.9rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff4d8d, #ff80ab, #ffc1cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.7rem;
            text-shadow: 0 0 20px rgba(255, 77, 141, 0.3);
        }

        .profile-bio {
            color: #e0e0e0;
            font-size: 1.12rem;
            line-height: 1.5;
            font-family: 'Poppins', 'Inter', sans-serif;
            font-weight: 400;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            margin-bottom: 0;
        }

        .btn-primary {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(45deg, #ff4d8d, #ff80ab);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            box-shadow: 0 6px 20px rgba(255, 77, 141, 0.25);
            position: relative;
            overflow: hidden;
            min-height: 44px; /* Minimum touch target */
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            -webkit-user-select: none; /* Prevent text selection on mobile */
            user-select: none;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 77, 141, 0.5);
            background: linear-gradient(45deg, #ff80ab, #ffc1cc);
            filter: brightness(1.1);
        }

        .btn-secondary {
            font-family: 'Inter', sans-serif;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 77, 141, 0.3);
            padding: 10px 25px;
            border-radius: 25px;
            color: white;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px; /* Minimum touch target */
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            -webkit-user-select: none; /* Prevent text selection on mobile */
            user-select: none;
        }

        .btn-secondary:hover {
            background: rgba(255, 77, 141, 0.2);
            transform: translateY(-2px);
        }

        .form-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            margin: 2rem auto;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 77, 141, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.6rem;
            color: #ff80ab;
            font-weight: 500;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 77, 141, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.08);
            color: white;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff4d8d;
            box-shadow: 0 0 15px rgba(255, 77, 141, 0.3);
            background: rgba(255, 255, 255, 0.1);
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 2rem 0;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 77, 141, 0.2);
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 1.2rem;
            margin: 0.8rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border-left: 4px solid #ff4d8d;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .leaderboard-rank {
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #ff4d8d;
            margin-right: 1.2rem;
            min-width: 50px;
        }

        .leaderboard-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 1.2rem;
            border: 2px solid #ff80ab;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1.2rem;
            color: #ff80ab;
            margin-bottom: 0.3rem;
        }

        .leaderboard-votes {
            color: #cccccc;
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
        }

        .timer-container {
            text-align: center;
            margin: 2.5rem 0;
            padding: 1.5rem;
            background: rgba(255, 77, 141, 0.12);
            border-radius: 15px;
            border: 1px solid rgba(255, 77, 141, 0.25);
        }

        .timer {
            font-family: 'Inter', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: #ff4d8d;
            margin: 0.8rem 0;
        }

        .nav-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: rgba(26, 15, 26, 0.98);
            min-width: 200px;
            border-radius: 12px;
            border: 1px solid #ff4d8d;
            z-index: 1001;
            margin-top: 12px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transform: translateY(-8px);
            transition: all 0.3s ease;
        }

        .dropdown-content.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .dropdown-content a {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            border-radius: 10px;
            margin: 6px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            min-height: 44px; /* Minimum touch target size */
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .dropdown-content a:hover {
            background: rgba(255, 77, 141, 0.15);
            color: #ff80ab;
        }

        .dropdown-content a.danger:hover {
            background: rgba(220, 53, 69, 0.15);
            color: #ff6b6b;
        }

        .vote-animation {
            animation: voteSuccess 0.6s ease;
        }

        @keyframes voteSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(2deg); }
            100% { transform: scale(1); }
        }

        .hidden {
            display: none;
        }

        .profile-upload {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .profile-preview {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            object-fit: cover;
            margin: 1rem auto;
            border: 4px solid #ff4d8d;
            display: block;
            box-shadow: 0 8px 25px rgba(255, 77, 141, 0.25);
        }

        .upload-btn {
            background: rgba(255, 77, 141, 0.12);
            border: 2px dashed #ff4d8d;
            padding: 2rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .upload-btn:hover {
            background: rgba(255, 77, 141, 0.2);
            border-color: #ff80ab;
        }

        .welcome-text {
            font-family: 'Montserrat', 'Poppins', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, #ff4d8d, #ff80ab, #ffc1cc, #ff4d8d);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: welcomeGlow 2s ease-in-out infinite, welcomeGradient 3s ease infinite, welcomeBounce 4s ease-in-out infinite;
            text-shadow: 0 0 40px rgba(255, 77, 141, 0.4);
            position: relative;
        }

        @keyframes welcomeGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 15px rgba(255, 77, 141, 0.4)); }
            50% { filter: brightness(1.3) drop-shadow(0 0 25px rgba(255, 77, 141, 0.7)); }
        }

        @keyframes welcomeGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes welcomeBounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .subtitle-text {
            font-family: 'Poppins', 'Inter', sans-serif;
            font-size: 2rem;
            font-weight: 400;
            text-align: center;
            margin-bottom: 2.5rem;
            color: #e0e0e0;
            animation: subtitleFade 3s ease-in-out infinite;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        @keyframes subtitleFade {
            0%, 100% { opacity: 0.8; transform: translateY(0px); }
            50% { opacity: 1; transform: translateY(-2px); }
        }

        .no-profiles-message {
            text-align: center;
            padding: 3rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin: 2rem auto;
            max-width: 550px;
        }

        .no-profiles-message h3 {
            font-family: 'Inter', sans-serif;
            font-size: 2rem;
            font-weight: 600;
            color: #ff80ab;
            margin-bottom: 1rem;
        }

        .no-profiles-message p {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            color: #cccccc;
            line-height: 1.5;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: #cccccc;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 77, 141, 0.2);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            /* Header adjustments */
            .header {
                padding: 0.75rem 0;
            }
            
            .logo {
                font-size: 1.8rem;
                letter-spacing: 0.5px;
            }
            
            /* Navigation dropdown mobile optimization */
            .nav-dropdown {
                position: relative;
            }
            
            /* Shrink the username toggle button on mobile */
            #dropdownToggle {
                padding: 8px 12px;
                font-size: 0.95rem;
                border-radius: 18px;
                min-height: 36px;
            }
            
            .dropdown-content {
                position: absolute;
                top: calc(100% + 8px);
                right: 0;
                left: auto;
                min-width: 180px;
                width: auto;
                max-width: 240px;
                border-radius: 10px;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
                padding: 6px 0;
            }
            
            .dropdown-content a {
                padding: 10px 14px;
                font-size: 0.9rem;
                margin: 1px 6px;
                border-radius: 6px;
                min-height: 36px;
            }
            
            /* Main content adjustments */
            .main-content {
                padding: 1rem;
                margin-top: 70px;
            }
            
            /* Typography adjustments */
            .section-title {
                font-size: 2.2rem;
                margin: 2rem 0 1.5rem 0;
                letter-spacing: 1px;
            }
            
            .welcome-text {
                font-size: 2.2rem;
                margin-bottom: 1rem;
            }
            
            .subtitle-text {
                font-size: 1.4rem;
                margin-bottom: 2rem;
            }
            
            /* Voting interface mobile optimization */
            .voting-container {
                grid-template-columns: 1fr;
                gap: 1.75rem;
                margin: 2rem 0;
                padding: 1rem;
                justify-items: center;
            }
            
            
            .profile-card {
                width: 100%;
                max-width: 92vw;
                padding: 2rem 2rem 1rem;
                margin: 0.5rem 0;
                min-height: 0; /* Let content define height */
            }
            
            .profile-photo {
                width: min(480px, 92vw);
                height: min(480px, 92vw);
                margin: 0 auto 1rem auto;
            }
            
            .profile-name {
                font-size: 1.9rem;
                margin-bottom: 0.7rem;
            }
            
            .profile-bio {
                font-size: 1.12rem;
                line-height: 1.5;
                margin-bottom: 0;
            }
            
            /* Form improvements */
            .form-container {
                padding: 1.5rem;
                margin: 1rem auto;
            }
            
            .form-group input,
            .form-group textarea {
                padding: 14px 16px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .btn-primary {
                padding: 14px 25px;
                font-size: 1.1rem;
                width: 100%;
                margin: 0.5rem 0;
            }
            
            .btn-secondary {
                padding: 12px 20px;
                font-size: 1rem;
                width: 100%;
                margin: 0.5rem 0;
            }
            
            /* Landing page buttons */
            .flex.justify-center.space-x-6 {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }
            
            .flex.justify-center.space-x-6 .btn-primary,
            .flex.justify-center.space-x-6 .btn-secondary {
                width: 100%;
                max-width: 280px;
            }
            
            /* Leaderboard mobile optimization */
            .leaderboard-item {
                padding: 1rem;
                margin: 0.5rem 0;
            }
            
            .leaderboard-photo {
                width: 50px;
                height: 50px;
            }
            
            .leaderboard-name {
                font-size: 1.1rem;
            }
            
            .leaderboard-votes {
                font-size: 0.9rem;
            }
            
            .leaderboard-rank {
                font-size: 1.3rem;
                min-width: 40px;
            }
            
            /* Timer adjustments */
            .timer {
                font-size: 1.5rem;
            }
            
            .timer-container {
                padding: 1rem;
                margin: 1.5rem 0;
            }
            
            /* Profile upload mobile */
            .profile-preview {
                width: 120px;
                height: 120px;
            }
            
            .upload-btn {
                padding: 1.5rem;
                font-size: 1rem;
            }
            
            /* No profiles message */
            .no-profiles-message {
                padding: 2rem 1rem;
                margin: 1rem auto;
            }
            
            .no-profiles-message h3 {
                font-size: 1.5rem;
            }
            
            .no-profiles-message p {
                font-size: 1rem;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .logo {
                font-size: 1.5rem;
            }
            
            .welcome-text {
                font-size: 1.8rem;
            }
            
            .subtitle-text {
                font-size: 1.2rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 0.5rem;
            }
            
            .form-container {
                padding: 1rem;
            }
            
            .profile-photo {
                width: 100px;
                height: 100px;
            }
            
            .profile-card {
                padding: 1rem;
            }
            
            .dropdown-content {
                left: 5px;
                right: 5px;
                width: calc(100% - 10px);
            }
        }

        /* Larger screens (laptops/desktops) */
        @media (min-width: 1024px) {
            .voting-container {
                grid-template-columns: 1fr 1fr;
                gap: 2.25rem;
                max-width: 1200px;
                padding: 2rem 2.5rem;
                justify-items: center;
            }

            .profile-card {
                width: 100%;
                max-width: 540px;
                padding: 3rem 2.75rem;
            }

            .profile-photo {
                width: 245px;
                height: 245px;
            }

            .profile-name {
                font-size: 2.2rem;
            }

            .profile-bio {
                font-size: 1.1rem;
            }
        }

        /* Extra large desktops */
        @media (min-width: 1280px) {
            .voting-container {
                grid-template-columns: 1fr 1fr;
                gap: 2.75rem;
                max-width: 1300px;
                justify-items: center;
            }

            .profile-card {
                max-width: 560px;
                padding: 3.25rem 2.75rem;
            }

            .profile-photo {
                width: 260px;
                height: 260px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background Particles -->
    <div class="particles" id="particles"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="logo">Bulookshub</div>
            <div id="userNav" class="hidden">
                <div class="nav-dropdown">
                    <button id="dropdownToggle" class="btn-primary">
                        <i class="fas fa-user"></i> <span id="userNameNav"></span> <i class="fas fa-chevron-down ml-2"></i>
                    </button>
                    <div id="dropdownContent" class="dropdown-content">
                        <a href="#" onclick="showVoting()"><i class="fas fa-vote-yea"></i> Voting</a>
                        <a href="#" onclick="showMyProfile()"><i class="fas fa-user-circle"></i> My Profile</a>
                        <a href="#" onclick="showLeaderboard()"><i class="fas fa-trophy"></i> Leaderboard</a>
                        <a href="#" onclick="deleteAccount()" class="danger"><i class="fas fa-trash-alt"></i> Delete Account</a>
                        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="main-content">
        <!-- Landing Page -->
        <div id="landingPage" class="text-center">
            <h1 class="welcome-text fade-in">
                Welcome to BU.Style
            </h1>
            <p class="subtitle-text fade-in fade-in-delay-1">Get Ready To Take Hot Takes On Hot Looks.</p>
            
            <div class="flex justify-center space-x-6 mt-8 fade-in fade-in-delay-2">
                <button onclick="showSignup()" class="btn-primary">
                    <i class="fas fa-user-plus"></i> Sign Up
                </button>
                <button onclick="showLogin()" class="btn-secondary">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
        </div>

        <!-- Signup Form -->
        <div id="signupPage" class="hidden">
            <div class="form-container">
                <h2 class="text-3xl font-bold text-center mb-6 text-pink-400">Join BU.Style</h2>
                <form id="signupForm">
                    <div class="form-group">
                        <label for="signupUsername">Username</label>
                        <input type="text" id="signupUsername" required placeholder="Choose a unique username">
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" required placeholder="Create a secure password">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" required placeholder="Re-enter your password">
                    </div>
                    <div class="form-group">
                        <label class="flex items-center">
                            <input type="checkbox" id="ageConfirm" required class="mr-3">
                            <span>I confirm that I'm participating voluntarily and am over 18 years old</span>
                        </label>
                    </div>
                    <button type="submit" class="btn-primary w-full">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                    <p class="text-center mt-6 text-lg">
                        Already have an account? 
                        <a href="#" onclick="showLogin()" class="text-pink-400 hover:text-pink-300 underline">Login</a>
                    </p>
                </form>
            </div>
        </div>

        <!-- Login Form -->
        <div id="loginPage" class="hidden">
            <div class="form-container">
                <h2 class="text-3xl font-bold text-center mb-6 text-pink-400">Welcome Back</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" id="loginUsername" required placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required placeholder="Enter your password">
                    </div>
                    <button type="submit" class="btn-primary w-full">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <p class="text-center mt-6 text-lg">
                        Don't have an account? 
                        <a href="#" onclick="showSignup()" class="text-pink-400 hover:text-pink-300 underline">Sign Up</a>
                    </p>
                </form>
            </div>
        </div>

        <!-- Profile Creation -->
        <div id="profileCreationPage" class="hidden">
            <div class="form-container">
                <h2 class="text-3xl font-bold text-center mb-6 text-pink-400">Create Your Profile</h2>
                <form id="profileForm">
                    <div class="profile-upload">
                        <img id="profilePreview" src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80" alt="Profile Preview" class="profile-preview">
                        <div class="upload-btn" onclick="document.getElementById('photoUpload').click()">
                            <i class="fas fa-camera text-2xl mb-2"></i>
                            <p>Click to upload your photo</p>
                        </div>
                        <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="form-group">
                        <label for="displayName">Display Name</label>
                        <input type="text" id="displayName" required maxlength="30" placeholder="How would you like to be known?">
                    </div>
                    <div class="form-group">
                        <label for="bio">Bio (150 characters max)</label>
                        <textarea id="bio" rows="4" maxlength="150" placeholder="Tell us about your style..."></textarea>
                        <div class="text-right text-sm text-gray-400 mt-1">
                            <span id="bioCount">0</span>/150
                        </div>
                    </div>
                    <button type="submit" class="btn-primary w-full">
                        <i class="fas fa-save"></i> Save Profile
                    </button>
                </form>
            </div>
        </div>

        <!-- Main Voting Interface -->
        <div id="votingPage" class="hidden">
            <div id="cloudLayer" class="cloud-layer"></div>
            <h2 class="section-title" style="margin-bottom: 3.5rem;">Hot Take: Who's Cooler?</h2>
            
            <div id="votingContainer" class="voting-container">
                <!-- Profile cards will be dynamically generated here -->
            </div>
            
            <div id="noProfilesMessage" class="no-profiles-message hidden">
                <h3>No Profiles Available</h3>
                <p>Be the first to join! Invite friends to start the fashion rating fun!</p>
            </div>
            
            <div class="text-center mt-8">
                <button onclick="loadNewProfiles()" class="btn-primary">
                    <i class="fas fa-refresh"></i> Show Different Styles
                </button>
            </div>
        </div>

        <!-- Leaderboard -->
        <div id="leaderboardPage" class="hidden">
            <h2 class="section-title">Coolest People Stay Here.</h2>
            
            <div class="timer-container">
                <p class="text-lg">Next reset in:</p>
                <div class="timer" id="resetTimer">--:--:--</div>
                <p class="text-sm text-gray-300 mt-2">Votes reset daily at midnight</p>
            </div>
            
            <div class="leaderboard" id="leaderboardContainer">
                <!-- Leaderboard items will be dynamically generated here -->
            </div>
            
            <div class="text-center mt-8">
                <button onclick="showVoting()" class="btn-primary">
                    <i class="fas fa-vote-yea"></i> Back to Voting
                </button>
            </div>
        </div>

        <!-- Profile Management -->
        <div id="profileManagePage" class="hidden">
            <div class="form-container">
                <h2 class="text-3xl font-bold text-center mb-6 text-pink-400">Edit Profile</h2>
                <form id="editProfileForm">
                    <div class="profile-upload">
                        <img id="editProfilePreview" src="" alt="Profile Preview" class="profile-preview">
                        <div class="upload-btn" onclick="document.getElementById('editPhotoUpload').click()">
                            <i class="fas fa-camera text-2xl mb-2"></i>
                            <p>Change Your Photo</p>
                        </div>
                        <input type="file" id="editPhotoUpload" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="form-group">
                        <label for="editDisplayName">Display Name</label>
                        <input type="text" id="editDisplayName" required maxlength="30">
                    </div>
                    <div class="form-group">
                        <label for="editBio">Bio (150 characters max)</label>
                        <textarea id="editBio" rows="4" maxlength="150"></textarea>
                        <div class="text-right text-sm text-gray-400 mt-1">
                            <span id="editBioCount">0</span>/150
                        </div>
                    </div>
                    <button type="submit" class="btn-primary w-full">
                        <i class="fas fa-save"></i> Update Profile
                    </button>
                </form>
                <div class="text-center mt-4">
                    <button onclick="showVoting()" class="btn-primary">
                        <i class="fas fa-vote-yea"></i> Go to Voting
                    </button>
                </div>
                
                <div class="text-center mt-8">
                    <button onclick="showVoting()" class="btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Voting
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>BU 2025 - Developed by Churchil Jain</p>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        console.log('BU.Style v4.0 - Starting Firebase initialization...');
        console.log('Build: 2025-01-27-v4-MOBILE-FIXED');
        
        // Add visible version indicator
        setTimeout(() => {
            const versionDiv = document.createElement('div');
            versionDiv.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                background: rgba(255, 77, 141, 0.9);
                color: white;
                padding: 8px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: bold;
                z-index: 10000;
                font-family: 'Inter', sans-serif;
                box-shadow: 0 4px 15px rgba(255, 77, 141, 0.3);
            `;
            versionDiv.textContent = 'v4.0 MOBILE-FIXED';
            document.body.appendChild(versionDiv);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (versionDiv.parentNode) {
                    versionDiv.parentNode.removeChild(versionDiv);
                }
            }, 5000);
        }, 1000);
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBMTWWC81Fkm-XBaaLZUL6Fd6sv8JJFMIg",
            authDomain: "bulookshub-1e20c.firebaseapp.com",
            projectId: "bulookshub-1e20c",
            storageBucket: "bulookshub-1e20c.firebasestorage.app",
            messagingSenderId: "1015585786589",
            appId: "1:1015585786589:web:f252e9bd8c34433c686934"
        };

        // Initialize Firebase
        let auth, db;
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        // Global variables
        let currentUser = null;
        let currentMatchup = [];
        let allProfiles = [];
        let unsubscribeProfiles = null;
        let unsubscribeVotes = null;
        let isInitialized = false;
        let isVoting = false; // Prevent spam clicking

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            console.log('Signup form exists:', !!document.getElementById('signupForm'));
            console.log('Login form exists:', !!document.getElementById('loginForm'));
            
            try {
                createParticles();
                initializeApp();
                setupEventListeners();
                setupDropdownNavigation();
                setupOfflineHandling();
            } catch (error) {
                console.error('Error during app initialization:', error);
                alert('Error initializing app: ' + error.message);
            }
        });

        // Create animated background particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size between 2px and 8px
                const size = Math.random() * 6 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Random position
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                
                // Random animation delay
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                
                // Random color variation
                const colors = [
                    'rgba(255, 77, 141, 0.1)',
                    'rgba(255, 128, 171, 0.1)',
                    'rgba(255, 193, 204, 0.1)',
                    'rgba(255, 77, 141, 0.05)'
                ];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                particlesContainer.appendChild(particle);
            }
        }

        // Utility functions
        function isOnline() {
            return navigator.onLine;
        }

        function showOfflineMessage() {
            // Create a simple offline notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff4d8d;
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 10000;
                font-family: 'Inter', sans-serif;
                font-weight: 500;
                box-shadow: 0 4px 15px rgba(255, 77, 141, 0.3);
            `;
            notification.textContent = 'You are offline. Some features may not work properly.';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        function showLoadingState(elementId, show = true) {
            const element = document.getElementById(elementId);
            if (element) {
                if (show) {
                    element.style.opacity = '0.6';
                    element.style.pointerEvents = 'none';
                } else {
                    element.style.opacity = '1';
                    element.style.pointerEvents = 'auto';
                }
            }
        }

        // Global error handler
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            alert('Error: ' + event.reason);
        });

        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            alert('Error: ' + event.error);
        });

        function setupDropdownNavigation() {
            const dropdownToggle = document.getElementById('dropdownToggle');
            const dropdownContent = document.getElementById('dropdownContent');
            
            // Toggle dropdown on button click
            dropdownToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                dropdownContent.classList.toggle('show');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.nav-dropdown')) {
                    dropdownContent.classList.remove('show');
                }
            });
            
            // Handle dropdown item clicks - simplified approach
            dropdownContent.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const link = e.target.closest('a');
                if (link) {
                    console.log('Dropdown link clicked:', link);
                    console.log('Link onclick:', link.getAttribute('onclick'));
                    
                    // Close dropdown first
                    dropdownContent.classList.remove('show');
                    
                    // Get the onclick function and execute it
                    const onclick = link.getAttribute('onclick');
                    if (onclick) {
                        console.log('Executing onclick function:', onclick);
                        // Use setTimeout to ensure dropdown closes first
                        setTimeout(() => {
                            try {
                                // Try direct function calls first
                                if (onclick.includes('showVoting()')) {
                                    showVoting();
                                } else if (onclick.includes('showMyProfile()')) {
                                    showMyProfile();
                                } else if (onclick.includes('showLeaderboard()')) {
                                    showLeaderboard();
                                } else if (onclick.includes('deleteAccount()')) {
                                    deleteAccount();
                                } else if (onclick.includes('logout()')) {
                                    logout();
                                } else {
                                    // Fallback to eval
                                    eval(onclick);
                                }
                                console.log('Function executed successfully');
                            } catch (error) {
                                console.error('Error executing function:', error);
                            }
                        }, 100);
                    } else {
                        console.log('No onclick attribute found');
                    }
                }
            });
            
            // Mobile-specific touch improvements
            if ('ontouchstart' in window) {
                // Add touch feedback for mobile
                dropdownToggle.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.95)';
                });
                
                dropdownToggle.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                });
            }
        }

        function setupOfflineHandling() {
            window.addEventListener('online', () => {
                console.log('Connection restored');
                if (!isOnline()) {
                    showOfflineMessage();
                }
            });

            window.addEventListener('offline', () => {
                console.log('Connection lost');
                showOfflineMessage();
            });
        }

        async function initializeApp() {
            try {
                console.log('Initializing app...');
                
                if (!auth) {
                    throw new Error('Firebase auth not initialized');
                }
                
                // Set up Firebase Auth state listener
                auth.onAuthStateChanged(async (user) => {
                    try {
                        if (user) {
                            currentUser = {
                                uid: user.uid,
                                email: user.email,
                                username: user.displayName || user.email.split('@')[0]
                            };
                            showUserInterface();
                            await setupRealtimeListeners();
                        } else {
                            currentUser = null;
                            cleanupListeners();
                            showLandingPage();
                        }
                    } catch (error) {
                        console.error('Error in auth state change:', error);
                    }
                });

                // Start the reset timer
                updateResetTimer();
                setInterval(updateResetTimer, 1000);
                
                isInitialized = true;
                console.log('App initialized successfully');
            } catch (error) {
                console.error('Error initializing app:', error);
                alert('Error initializing app: ' + error.message);
                showLandingPage();
            }
        }

        async function setupRealtimeListeners() {
            if (!currentUser) return;

            try {
                // Set up real-time listener for all user profiles
                unsubscribeProfiles = db.collection('users').onSnapshot((querySnapshot) => {
                    console.log('Profiles updated, refreshing data...');
                    allProfiles = [];
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.profile) {
                            allProfiles.push({
                                id: doc.id,
                                username: data.username,
                                ...data.profile
                            });
                        }
                    });
                    
                    console.log('Total profiles loaded:', allProfiles.length);
                    
                    // Update voting page if it's visible
                    if (!document.getElementById('votingPage').classList.contains('hidden')) {
                        loadNewProfiles();
                    }
                    
                    // Update leaderboard if it's visible
                    if (!document.getElementById('leaderboardPage').classList.contains('hidden')) {
                        updateLeaderboard();
                    }
                });

                // Set up real-time listener for votes to update leaderboard immediately
                unsubscribeVotes = db.collection('dailyVotes').onSnapshot((querySnapshot) => {
                    console.log('Votes updated, refreshing leaderboard...');
                    // Only update leaderboard if it's currently visible
                    if (!document.getElementById('leaderboardPage').classList.contains('hidden')) {
                        updateLeaderboard();
                    }
                });
            } catch (error) {
                console.error('Error setting up real-time listeners:', error);
            }
        }

        function cleanupListeners() {
            if (unsubscribeProfiles) {
                unsubscribeProfiles();
                unsubscribeProfiles = null;
            }
            if (unsubscribeVotes) {
                unsubscribeVotes();
                unsubscribeVotes = null;
            }
        }

        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Signup form
            const signupForm = document.getElementById('signupForm');
            if (signupForm) {
                signupForm.addEventListener('submit', handleSignup);
                console.log('Signup form listener added');
            }
            
            // Login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('Login form listener added');
            }
            
            // Profile creation form
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', handleProfileCreation);
                console.log('Profile form listener added');
            }
            
            // Profile editing form
            const editProfileForm = document.getElementById('editProfileForm');
            if (editProfileForm) {
                editProfileForm.addEventListener('submit', handleProfileEdit);
                console.log('Edit profile form listener added');
            }
            
            // Photo upload handlers
            const photoUpload = document.getElementById('photoUpload');
            if (photoUpload) {
                photoUpload.addEventListener('change', handlePhotoUpload);
            }
            
            const editPhotoUpload = document.getElementById('editPhotoUpload');
            if (editPhotoUpload) {
                editPhotoUpload.addEventListener('change', handleEditPhotoUpload);
            }
            
            // Bio character counter
            const bio = document.getElementById('bio');
            if (bio) {
                bio.addEventListener('input', updateBioCount);
            }
            
            const editBio = document.getElementById('editBio');
            if (editBio) {
                editBio.addEventListener('input', updateEditBioCount);
            }
            
            console.log('Event listeners setup complete');
        }

        // Navigation functions
        function showLandingPage() {
            hideAllPages();
            document.getElementById('landingPage').classList.remove('hidden');
            closeDropdown();
        }

        function showSignup() {
            hideAllPages();
            document.getElementById('signupPage').classList.remove('hidden');
            closeDropdown();
        }

        function showLogin() {
            hideAllPages();
            document.getElementById('loginPage').classList.remove('hidden');
            closeDropdown();
        }

        function showProfileCreation() {
            hideAllPages();
            document.getElementById('profileCreationPage').classList.remove('hidden');
            closeDropdown();
        }

        function showVoting() {
            hideAllPages();
            document.getElementById('votingPage').classList.remove('hidden');
            ensureVotingClouds();
            loadNewProfiles();
            closeDropdown();
        }

        function showLeaderboard() {
            hideAllPages();
            document.getElementById('leaderboardPage').classList.remove('hidden');
            updateLeaderboard();
            closeDropdown();
        }

        function showMyProfile() {
            hideAllPages();
            document.getElementById('profileManagePage').classList.remove('hidden');
            loadCurrentUserProfile();
            closeDropdown();
        }

        function closeDropdown() {
            const dropdownContent = document.getElementById('dropdownContent');
            if (dropdownContent) {
                dropdownContent.classList.remove('show');
            }
        }

        function hideAllPages() {
            const pages = ['landingPage', 'signupPage', 'loginPage', 'profileCreationPage', 'votingPage', 'leaderboardPage', 'profileManagePage'];
            pages.forEach(pageId => {
                document.getElementById(pageId).classList.add('hidden');
            });
        }

        // Create subtle drifting clouds on the voting page (runs once)
        function ensureVotingClouds() {
            const layer = document.getElementById('cloudLayer');
            if (!layer || layer.childElementCount > 0) return;
            const cloudSpecs = [
                { top: '8%',  left: '-20%', width: 260, height: 120, duration: 70 },
                { top: '18%', left: '-25%', width: 340, height: 160, duration: 90 },
                { top: '72%', left: '-30%', width: 320, height: 150, duration: 85 },
                { top: '82%', left: '-15%', width: 240, height: 110, duration: 65 }
            ];
            cloudSpecs.forEach((spec, idx) => {
                const c = document.createElement('div');
                c.className = 'cloud';
                c.style.top = spec.top;
                c.style.left = spec.left;
                c.style.width = spec.width + 'px';
                c.style.height = spec.height + 'px';
                c.style.animationDuration = spec.duration + 's';
                c.style.animationDelay = (idx * 5) + 's';
                layer.appendChild(c);
            });
        }

        function showUserInterface() {
            document.getElementById('userNav').classList.remove('hidden');
            document.getElementById('userNameNav').textContent = currentUser.username;
            showVoting();
        }

        // Authentication functions
        async function handleSignup(e) {
            console.log('handleSignup called');
            e.preventDefault();
            
            const username = document.getElementById('signupUsername').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const ageConfirm = document.getElementById('ageConfirm').checked;
            
            console.log('Signup data:', { username, password: password ? '***' : 'empty', confirmPassword: confirmPassword ? '***' : 'empty', ageConfirm });

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (!ageConfirm) {
                alert('You must confirm that you are over 18 and participating voluntarily.');
                return;
            }

            if (username.length < 3) {
                alert('Username must be at least 3 characters long!');
                return;
            }

            if (!isOnline()) {
                alert('You need to be online to create an account.');
                return;
            }

            showLoadingState('signupForm', true);

            try {
                // Create email from username for Firebase Auth
                const email = `${username}@bustyle.local`;
                
                // Create Firebase user
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Create user profile in Firestore
                await db.collection('users').doc(userCredential.user.uid).set({
                    username: username,
                    email: email,
                    profile: null,
                    createdAt: new Date(),
                    updatedAt: new Date()
                });

                // Clear form
                document.getElementById('signupForm').reset();
                
                showProfileCreation();
            } catch (error) {
                console.error('Signup error:', error);
                if (error.code === 'auth/email-already-in-use') {
                    alert('Username already exists! Please choose a different username.');
                } else if (error.code === 'auth/weak-password') {
                    alert('Password is too weak. Please choose a stronger password.');
                } else {
                    alert('Error creating account. Please try again.');
                }
            } finally {
                showLoadingState('signupForm', false);
            }
        }

        async function handleLogin(e) {
            console.log('handleLogin called');
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            console.log('Login data:', { username, password: password ? '***' : 'empty' });

            if (!isOnline()) {
                alert('You need to be online to login.');
                return;
            }

            showLoadingState('loginForm', true);

            try {
                // Create email from username for Firebase Auth
                const email = `${username}@bustyle.local`;
                
                // Sign in with Firebase
                await auth.signInWithEmailAndPassword(email, password);
                
                // Clear form
                document.getElementById('loginForm').reset();
                
                // The onAuthStateChange listener will handle the rest
            } catch (error) {
                console.error('Login error:', error);
                if (error.code === 'auth/user-not-found') {
                    alert('Username not found! Please check your username or sign up.');
                } else if (error.code === 'auth/wrong-password') {
                    alert('Incorrect password! Please try again.');
                } else if (error.code === 'auth/invalid-email') {
                    alert('Invalid username format!');
                } else {
                    alert('Error logging in. Please try again.');
                }
            } finally {
                showLoadingState('loginForm', false);
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                // The onAuthStateChange listener will handle the rest
            } catch (error) {
                console.error('Logout error:', error);
                alert('Error logging out. Please try again.');
            }
            closeDropdown();
        }

        async function deleteAccount() {
            if (!currentUser) return;
            
            const confirmation = confirm('Are you sure you want to delete your account? This action cannot be undone.');
            
            if (!confirmation) return;

            if (!isOnline()) {
                alert('You need to be online to delete your account.');
                return;
            }

            try {
                // Delete user data from Firestore and related votes
                await deleteUserAccount(currentUser.uid);

                // Reauthenticate if required, then delete auth user
                try {
                    await auth.currentUser.delete();
                } catch (err) {
                    if (err && err.code === 'auth/requires-recent-login') {
                        alert('Please log in again to confirm deletion.');
                        await logout();
                        return;
                    }
                    throw err;
                }

                alert('Your account has been successfully deleted.');
            } catch (error) {
                console.error('Delete account error:', error);
                alert('Error deleting account. Please try again.');
            }
        }

        // Deletes user document and today's votes by or for the user
        async function deleteUserAccount(userId) {
            // Delete user document
            try {
                await db.collection('users').doc(userId).delete();
            } catch (e) {
                console.warn('Failed to delete user document:', e?.message || e);
            }

            // Best-effort cleanup of today's votes
            try {
                const today = new Date().toDateString();
                const votesBySnapshot = await db.collection('dailyVotes').where('date', '==', today).where('votedBy', '==', userId).get();
                const votesForSnapshot = await db.collection('dailyVotes').where('date', '==', today).where('votedFor', '==', userId).get();
                const batch = db.batch();
                votesBySnapshot.forEach(doc => batch.delete(doc.ref));
                votesForSnapshot.forEach(doc => batch.delete(doc.ref));
                if (!votesBySnapshot.empty || !votesForSnapshot.empty) {
                    await batch.commit();
                }
            } catch (e) {
                console.warn('Failed to clean up votes:', e?.message || e);
            }
        }

        // Profile functions
        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profilePreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function handleEditPhotoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('editProfilePreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function updateBioCount() {
            const bio = document.getElementById('bio').value;
            document.getElementById('bioCount').textContent = bio.length;
        }

        function updateEditBioCount() {
            const bio = document.getElementById('editBio').value;
            document.getElementById('editBioCount').textContent = bio.length;
        }

        async function handleProfileCreation(e) {
            e.preventDefault();
            
            const displayName = document.getElementById('displayName').value.trim();
            const bio = document.getElementById('bio').value.trim();
            const photo = document.getElementById('profilePreview').src;

            if (displayName.length < 2) {
                alert('Display name must be at least 2 characters long!');
                return;
            }

            if (!isOnline()) {
                alert('You need to be online to create your profile.');
                return;
            }

            showLoadingState('profileForm', true);

            try {
                const profileData = {
                    username: currentUser.username,
                    email: currentUser.email,
                    profile: {
                        displayName: displayName,
                        bio: bio,
                        photo: photo
                    },
                    updatedAt: new Date()
                };

                await db.collection('users').doc(currentUser.uid).update(profileData);
                
                // Navigate to voting after successful save
                showVoting();
                
                // Clear form
                document.getElementById('profileForm').reset();
                
                // The real-time listener will update the UI
            } catch (error) {
                console.error('Profile creation error:', error);
                alert('Error creating profile. Please try again.');
            } finally {
                showLoadingState('profileForm', false);
            }
        }

        async function loadCurrentUserProfile() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                
                if (userData && userData.profile) {
                    document.getElementById('editProfilePreview').src = userData.profile.photo;
                    document.getElementById('editDisplayName').value = userData.profile.displayName;
                    document.getElementById('editBio').value = userData.profile.bio;
                    updateEditBioCount();
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                alert('Error loading profile. Please try again.');
            }
        }

        async function handleProfileEdit(e) {
            e.preventDefault();
            
            const displayName = document.getElementById('editDisplayName').value.trim();
            const bio = document.getElementById('editBio').value.trim();
            const photo = document.getElementById('editProfilePreview').src;

            if (displayName.length < 2) {
                alert('Display name must be at least 2 characters long!');
                return;
            }

            if (!isOnline()) {
                alert('You need to be online to update your profile.');
                return;
            }

            showLoadingState('editProfileForm', true);

            try {
                const profileData = {
                    username: currentUser.username,
                    email: currentUser.email,
                    profile: {
                        displayName: displayName,
                        bio: bio,
                        photo: photo
                    },
                    updatedAt: new Date()
                };

                await db.collection('users').doc(currentUser.uid).update(profileData);
                
                alert('Profile updated successfully!');
                showVoting();
            } catch (error) {
                console.error('Profile edit error:', error);
                alert('Error updating profile. Please try again.');
            } finally {
                showLoadingState('editProfileForm', false);
            }
        }

        // Voting functions
        function loadNewProfiles() {
            if (allProfiles.length < 2) {
                showNoProfilesMessage();
                return;
            }
            
            const availableProfiles = allProfiles.filter(profile => profile.id !== currentUser.uid);
            
            if (availableProfiles.length < 2) {
                showNoProfilesMessage();
                return;
            }
            
            // Get two random profiles
            const shuffled = availableProfiles.sort(() => 0.5 - Math.random());
            currentMatchup = shuffled.slice(0, 2);
            
            hideNoProfilesMessage();
            displayVotingProfiles();
        }

        function showNoProfilesMessage() {
            document.getElementById('votingContainer').innerHTML = '';
            document.getElementById('noProfilesMessage').classList.remove('hidden');
        }

        function hideNoProfilesMessage() {
            document.getElementById('noProfilesMessage').classList.add('hidden');
        }

        function displayVotingProfiles() {
            const container = document.getElementById('votingContainer');
            container.innerHTML = '';

            currentMatchup.forEach((profile, index) => {
                const card = document.createElement('div');
                card.className = 'profile-card';
                card.setAttribute('data-user-id', profile.id);
                card.setAttribute('data-index', index);
                
                card.innerHTML = `
                    <img src="${profile.photo}" alt="${profile.displayName}" class="profile-photo">
                    <div class="profile-name">${profile.displayName}</div>
                    <div class="profile-bio">${profile.bio}</div>
                `;
                
                // Add click handler for voting - use addEventListener for better control
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    vote(profile.id, index);
                });
                
                // Add touch feedback for mobile devices
                if ('ontouchstart' in window) {
                    card.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.98)';
                        this.style.transition = 'transform 0.1s ease';
                    });
                    
                    card.addEventListener('touchend', function() {
                        this.style.transform = 'scale(1)';
                    });
                    
                    card.addEventListener('touchcancel', function() {
                        this.style.transform = 'scale(1)';
                    });
                }
                
                container.appendChild(card);
            });
        }

        function vote(votedForUserId, votedCardIndex) {
            console.log('Voting for:', votedForUserId, 'at index:', votedCardIndex);
            
            // Prevent spam clicking
            if (isVoting) {
                console.log('Already voting, please wait...');
                return;
            }
            
            // Basic validation - fail silently if not logged in
            if (!currentUser) {
                console.log('User not logged in, cannot vote');
                return;
            }

            if (!votedForUserId) {
                console.log('Invalid vote target');
                return;
            }

            // Set voting flag to prevent spam
            isVoting = true;

            // Show animation on the voted card
            const votedCard = document.querySelector(`[data-user-id="${votedForUserId}"]`);
            if (votedCard) {
                votedCard.classList.add('vote-animation');
                // Add a subtle glow effect to show it was selected
                votedCard.style.borderColor = '#ff80ab';
                votedCard.style.boxShadow = '0 15px 35px rgba(255, 77, 141, 0.5)';
            }
            
            // Save to database first, then update UI
            saveVoteToDatabase(votedForUserId).then(() => {
                // Update leaderboard immediately after vote is saved
                if (!document.getElementById('leaderboardPage').classList.contains('hidden')) {
                    updateLeaderboard();
                }
            });
            
            // Replace the other profile after a shorter delay for snappier UX
            setTimeout(() => {
                replaceOtherProfile(votedCardIndex);
                // Reset the voted card styling
                if (votedCard) {
                    votedCard.classList.remove('vote-animation');
                    votedCard.style.borderColor = '';
                    votedCard.style.boxShadow = '';
                }
                
                // Re-enable voting shortly after
                setTimeout(() => {
                    isVoting = false;
                }, 250);
            }, 600);
        }

        async function saveVoteToDatabase(votedForUserId) {
            try {
                console.log('Saving vote to database...');
                const voteData = {
                    votedFor: votedForUserId,
                    votedBy: currentUser.uid,
                    date: new Date().toDateString(),
                    timestamp: new Date()
                };
                
                await db.collection('dailyVotes').add(voteData);
                console.log('Vote saved successfully');
                return true;
            } catch (error) {
                console.log('Database save failed:', error.message);
                // Don't show error to user since UI already worked
                return false;
            }
        }

        function replaceOtherProfile(keepIndex) {
            console.log('Replacing other profile, keeping index:', keepIndex);
            
            // Get available profiles (excluding current user and already shown profiles)
            const availableProfiles = allProfiles.filter(profile => 
                profile.id !== currentUser.uid && 
                !currentMatchup.some(match => match.id === profile.id)
            );
            
            if (availableProfiles.length === 0) {
                console.log('No more profiles available, reloading all profiles');
                // If no more unique profiles, reload with fresh set
                setTimeout(() => {
                    loadNewProfiles();
                }, 1000);
                return;
            }
            
            // Get a random new profile
            const newProfile = availableProfiles[Math.floor(Math.random() * availableProfiles.length)];
            
            // Replace the other card (not the one that was voted for)
            const otherIndex = keepIndex === 0 ? 1 : 0;
            const otherCard = document.querySelector(`[data-index="${otherIndex}"]`);
            
            if (otherCard) {
                // Add fade out effect (slightly faster)
                otherCard.style.transition = 'all 0.22s ease';
                otherCard.style.opacity = '0.2';
                otherCard.style.transform = 'scale(0.94)';
                
                setTimeout(() => {
                    // Update the card with new profile data
                    otherCard.setAttribute('data-user-id', newProfile.id);
                    otherCard.querySelector('.profile-photo').src = newProfile.photo;
                    otherCard.querySelector('.profile-name').textContent = newProfile.displayName;
                    otherCard.querySelector('.profile-bio').textContent = newProfile.bio;
                    
                    // Fade back in
                    otherCard.style.opacity = '1';
                    otherCard.style.transform = 'scale(1)';
                    
                    // Update currentMatchup
                    currentMatchup[otherIndex] = newProfile;
                    
                    console.log('Profile replaced successfully with:', newProfile.displayName);
                    
                    // Reset transition after animation
                    setTimeout(() => {
                        otherCard.style.transition = '';
                    }, 220);
                }, 220);
            }
        }

        // Leaderboard functions
        async function updateLeaderboard() {
            try {
                console.log('Updating leaderboard...');
                const today = new Date().toDateString();
                const votesSnapshot = await db.collection('dailyVotes').where('date', '==', today).get();
                
                const todaysVotes = {};
                votesSnapshot.forEach(doc => {
                    const data = doc.data();
                    const userId = data.votedFor;
                    if (userId) {
                        todaysVotes[userId] = (todaysVotes[userId] || 0) + 1;
                    }
                });
                
                console.log('Today\'s votes:', todaysVotes);
                console.log('Available profiles:', allProfiles.length);
                
                // Filter profiles that have votes or show all if no votes yet
                const profilesWithVotes = allProfiles.filter(profile => todaysVotes[profile.id] > 0);
                const leaderboard = allProfiles.map(profile => ({
                    ...profile,
                    votes: todaysVotes[profile.id] || 0
                })).sort((a, b) => b.votes - a.votes).slice(0, 20);
                
                const container = document.getElementById('leaderboardContainer');
                
                if (leaderboard.length === 0 || leaderboard.every(p => p.votes === 0)) {
                    container.innerHTML = '<div class="text-center text-gray-400 text-lg">No votes yet today! Be the first to start voting!</div>';
                    return;
                }
                
                container.innerHTML = '';
                
                leaderboard.forEach((profile, index) => {
                    // Only show profiles with votes
                    if (profile.votes === 0) return;
                    
                    const item = document.createElement('div');
                    item.className = 'leaderboard-item';
                    
                    item.innerHTML = `
                        <div class="leaderboard-rank">#${index + 1}</div>
                        <img src="${profile.photo}" alt="${profile.displayName}" class="leaderboard-photo">
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${profile.displayName}</div>
                            <div class="leaderboard-votes">${profile.votes} vote${profile.votes !== 1 ? 's' : ''} today</div>
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
                
                console.log('Leaderboard updated successfully with', leaderboard.filter(p => p.votes > 0).length, 'entries');
            } catch (error) {
                console.error('Error updating leaderboard:', error);
                const container = document.getElementById('leaderboardContainer');
                container.innerHTML = '<div class="text-center text-gray-400 text-lg">Error loading leaderboard: ' + error.message + '</div>';
            }
        }

        // Timer functions
        function updateResetTimer() {
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeLeft = tomorrow.getTime() - now.getTime();
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            const timerElement = document.getElementById('resetTimer');
            if (timerElement) {
                timerElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
    </script>
</body>
</html>
